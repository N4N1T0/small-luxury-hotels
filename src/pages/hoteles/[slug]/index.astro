---
import Layout from '@/layouts/Layout.astro';
import HotelHero from '@/components/hotels/HotelHero.astro';
import BookingForm from '@/components/hotels/preact-hotel/BookingForm';
import RoomList from '@/components/hotels/RoomList.astro';
import BlogCarousel from '@/components/shared/blog-carousel/BlogCarousel.astro';
import HotelLocation from '@/components/hotels/preact-hotel/HotelLocation';
import HotelDescription from '@/components/hotels/HotelDescription.astro';
import HotelExperiences from '@/components/hotels/HotelExperiences.astro';
import { getAllHotels, getHotelBySlug } from '@/lib/fetchers/hotels';
import { getRoomsByHotel } from '@/lib/fetchers/rooms';
import { getExperiencesByHotel } from '@/lib/fetchers/experiences';

export async function getStaticPaths() {
  const hotels = await getAllHotels();

  return hotels.map((hotel) => {
    return {
      params: { slug: hotel.id }
    };
  });
}

const { slug } = Astro.params;
const hotel = await getHotelBySlug(slug);
const rooms = await getRoomsByHotel(slug);
const experiences = await getExperiencesByHotel(slug);

if (!hotel) {
  throw new Error(`No experience found with slug "${slug}"`);
}
---

<Layout title={hotel.data.title}>
  <HotelHero hotel={hotel} />
  <BookingForm client:visible hotel={hotel} />
  <HotelDescription hotel={hotel} />
  <RoomList rooms={rooms} />
  <HotelExperiences experiences={experiences} />
  <HotelLocation client:visible client:only={true} hotel={hotel} />
  <BlogCarousel />
</Layout>
