---
import { Image } from 'astro:assets';

interface Image {
  url: string;
  alt: string;
}

interface Props {
  images: Image[];
}

const { images } = Astro.props;
const bigImagesIndex = [0, 2, 4, 6];

// Validate minimum required images
if (images.length < 8) {
  throw new Error('ExperienceGallery requires at least 8 images');
}
---

{
  images.length > 0 && (
    <section class="py-8">
      <div
        class="grid auto-rows-[200px] grid-cols-2 grid-rows-[repeat(10)] gap-4"
        id="gallery-lightbox"
      >
        {images.slice(0, 8).map((image, index) => (
          <div
            class:list={[
              'group col-span-1 overflow-hidden shadow-md transition-transform',
              {
                'row-span-3': bigImagesIndex.includes(index),
                'row-span-2': !bigImagesIndex.includes(index)
              }
            ]}
          >
            <a
              class="lightbox"
              href={image.url}
              data-pswp-width="800"
              data-pswp-height="800"
              target="_blank"
              data-cropped="true"
            >
              <Image
                src={image.url}
                alt={image.alt}
                width={600}
                height={600}
                class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-110 hover:scale-105"
                loading={index <= 2 ? 'eager' : 'lazy'}
              />
            </a>
          </div>
        ))}
      </div>
    </section>
  )
}

<script>
  // Photoswipe y estilos
  import PhotoSwipeLightbox from 'photoswipe/lightbox';
  import 'photoswipe/style.css';

  // Configurar e inicializar Photoswipe
  const lightbox = new PhotoSwipeLightbox({
    gallery: '#gallery-lightbox',
    children: 'a',
    pswpModule: () => import('photoswipe')
  });
  lightbox.init();
</script>
